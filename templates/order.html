{% extends "base.html" %}
{% block title %}Order Gas Cylinders{% endblock %}
{% block content %}
<div class="max-w-3xl mx-auto py-10">
  <h1 class="text-3xl font-bold text-center mb-8">Order Gas Cylinders</h1>

  <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mb-10">
    <div class="bg-white shadow-lg rounded-xl p-5 text-center border">
      <h2 class="text-xl font-semibold mb-2">Small Cylinder</h2>
      <p class="text-gray-600 mb-3">5kg - ₦5,000</p>
      <button data-type="Small" class="order-btn bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Order Now</button>
    </div>

    <div class="bg-white shadow-lg rounded-xl p-5 text-center border">
      <h2 class="text-xl font-semibold mb-2">Big Cylinder</h2>
      <p class="text-gray-600 mb-3">12.5kg - ₦12,000</p>
      <button data-type="Big" class="order-btn bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">Order Now</button>
    </div>
  </div>

  <!-- Modal -->
  <div id="orderModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 flex justify-center items-center z-50">
    <div class="bg-white rounded-xl shadow-xl w-96 p-6 relative">
      <h2 class="text-xl font-bold mb-4 text-gray-800">Place Order</h2>
      <form id="orderForm">
        <label class="block text-sm font-medium text-gray-700 mb-1">Cylinder Type</label>
        <input type="text" id="cylinderType" required readonly class="w-full border rounded-lg px-3 py-2 mb-3 bg-gray-100">

        <label class="block text-sm font-medium text-gray-700 mb-1">Quantity</label>
        <input type="number" id="quantity" required value="1" min="1" class="w-full border rounded-lg px-3 py-2 mb-3">

        <label class="block text-sm font-medium text-gray-700 mb-1">Select Location</label>
        <select id="locationSelect" required class="w-full border rounded-lg px-3 py-2 mb-4">
  <option value="" disabled selected>Select delivery location</option>
  {% for loc in locations %}
    <option value="{{ loc.id }}">{{ loc.name or 'Unnamed' }}</option>
  {% endfor %}
</select>


        <div class="flex justify-end gap-2">
          <button type="button" id="cancelModal" class="bg-gray-300 px-4 py-2 rounded-lg hover:bg-gray-400">Cancel</button>
          <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Confirm</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  const orderButtons = document.querySelectorAll('.order-btn');
  const orderModal = document.getElementById('orderModal');
  const cylinderTypeInput = document.getElementById('cylinderType');
  const cancelModal = document.getElementById('cancelModal');
  const orderForm = document.getElementById('orderForm');

  orderButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      cylinderTypeInput.value = btn.dataset.type;
      orderModal.classList.remove('hidden');
    });
  });

  cancelModal.addEventListener('click', () => {
    orderModal.classList.add('hidden');
  });

  orderForm.addEventListener('submit', async e => {
    e.preventDefault();
    const cylinder_type = cylinderTypeInput.value;
    const quantity = document.getElementById('quantity').value;
    const location_id = document.getElementById('locationSelect').value;

    const res = await fetch('/place_order', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ cylinder_type, quantity, location_id })
    });

    if (res.ok) {
      alert("✅ Order placed successfully!");
      orderModal.classList.add('hidden');
    } else {
      alert("❌ Failed to place order.");
    }
  });
</script>
{% endblock %}
